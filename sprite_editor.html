<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Bitmap Editor</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        
        .editor-panel {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        canvas {
            border: 2px solid #3c3c3c;
            cursor: crosshair;
            image-rendering: pixelated;
            background: #000;
        }
        
        .controls {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #cccccc;
        }
        
        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #3c3c3c;
            background: #3c3c3c;
            color: #d4d4d4;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        input[type="color"] {
            width: 100%;
            height: 50px;
            border: 1px solid #3c3c3c;
            background: #3c3c3c;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            background: #0e639c;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #1177bb;
        }
        
        button.secondary {
            background: #3c3c3c;
        }
        
        button.secondary:hover {
            background: #4e4e4e;
        }
        
        button.danger {
            background: #c5000b;
        }
        
        button.danger:hover {
            background: #e81123;
        }
        
        .color-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .color-preset {
            width: 100%;
            height: 40px;
            border: 2px solid #3c3c3c;
            cursor: pointer;
            border-radius: 4px;
            transition: border-color 0.2s;
        }
        
        .color-preset:hover {
            border-color: #0e639c;
        }
        
        .preview {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }
        
        #previewCanvas {
            image-rendering: pixelated;
            border: 2px solid #3c3c3c;
        }
        
        .code-output {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre;
            margin-top: 10px;
        }
        
        h1, h2, h3 {
            color: #ffffff;
        }
        
        h1 {
            margin-top: 0;
        }
        
        .info {
            background: #3c3c3c;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #cccccc;
        }
        
        .tool-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .tool-buttons button {
            margin: 0;
        }
        
        .active-tool {
            background: #16825d !important;
        }
    </style>
</head>
<body>
    <h1>üé® Sprite Bitmap Editor</h1>
    
    <div class="container">
        <div class="editor-panel">
            <div class="control-group">
                <label>Grid Size:</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <input type="number" id="width" value="16" min="1" max="128">
                        <small>Width</small>
                    </div>
                    <div>
                        <input type="number" id="height" value="16" min="1" max="128">
                        <small>Height</small>
                    </div>
                </div>
                <button onclick="resizeCanvas()" class="secondary" style="margin-top: 10px;">Resize Canvas</button>
            </div>
            
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
            
            <div class="preview">
                <h3>Preview (Actual Size)</h3>
                <canvas id="previewCanvas"></canvas>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>Drawing Tool:</label>
                <div class="tool-buttons">
                    <button onclick="setTool('draw')" id="drawBtn" class="active-tool">‚úèÔ∏è Draw</button>
                    <button onclick="setTool('erase')" id="eraseBtn">üßπ Erase</button>
                    <button onclick="setTool('fill')" id="fillBtn">ü™£ Fill</button>
                    <button onclick="setTool('picker')" id="pickerBtn">üíâ Picker</button>
                </div>
            </div>
            
            <div class="control-group">
                <label>Current Color:</label>
                <input type="color" id="colorPicker" value="#FF0000">
                <div class="color-presets">
                    <div class="color-preset" style="background: #FF0000;" onclick="setColor('#FF0000')"></div>
                    <div class="color-preset" style="background: #00FF00;" onclick="setColor('#00FF00')"></div>
                    <div class="color-preset" style="background: #0000FF;" onclick="setColor('#0000FF')"></div>
                    <div class="color-preset" style="background: #FFFF00;" onclick="setColor('#FFFF00')"></div>
                    <div class="color-preset" style="background: #FF00FF;" onclick="setColor('#FF00FF')"></div>
                    <div class="color-preset" style="background: #00FFFF;" onclick="setColor('#00FFFF')"></div>
                    <div class="color-preset" style="background: #FFFFFF;" onclick="setColor('#FFFFFF')"></div>
                    <div class="color-preset" style="background: #000000;" onclick="setColor('#000000')"></div>
                </div>
            </div>
            
            <div class="control-group">
                <label>Transparent Color (RGB565 Hex):</label>
                <input type="text" id="transparentColor" value="0x0000" placeholder="0x0000">
                <small style="color: #888;">Used for sprite transparency</small>
            </div>
            
            <div class="control-group">
                <label>Sprite Name:</label>
                <input type="text" id="spriteName" value="MY_SPRITE" placeholder="MY_SPRITE">
            </div>
            
            <div class="control-group">
                <button onclick="clearCanvas()" class="danger">Clear Canvas</button>
                <button onclick="generateCode()" style="margin-top: 10px;">Generate Code</button>
                <button onclick="copyToClipboard()" class="secondary">Copy to Clipboard</button>
            </div>
            
            <div class="info">
                <strong>Instructions:</strong><br>
                ‚Ä¢ Left click to draw/use tool<br>
                ‚Ä¢ Use color picker for custom colors<br>
                ‚Ä¢ Fill tool fills connected pixels<br>
                ‚Ä¢ Generated code uses RGB565 format<br>
                ‚Ä¢ Paste output directly into assets.hpp
            </div>
        </div>
    </div>
    
    <div class="editor-panel" style="margin-top: 20px;">
        <h2>Generated Code</h2>
        <div class="code-output" id="codeOutput">// Click "Generate Code" to see output here</div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const previewCanvas = document.getElementById('previewCanvas');
        const previewCtx = previewCanvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        
        let width = 16;
        let height = 16;
        let cellSize = 20;
        let pixels = [];
        let isDrawing = false;
        let currentTool = 'draw';
        
        function initCanvas() {
            width = parseInt(document.getElementById('width').value);
            height = parseInt(document.getElementById('height').value);
            
            canvas.width = width * cellSize;
            canvas.height = height * cellSize;
            
            previewCanvas.width = width;
            previewCanvas.height = height;
            previewCanvas.style.width = (width * 4) + 'px';
            previewCanvas.style.height = (height * 4) + 'px';
            
            pixels = Array(height).fill().map(() => Array(width).fill(null));
            drawGrid();
            updatePreview();
        }
        
        function drawGrid() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw pixels
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (pixels[y][x]) {
                        ctx.fillStyle = pixels[y][x];
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                    }
                }
            }
            
            // Draw grid lines
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let x = 0; x <= width; x++) {
                ctx.beginPath();
                ctx.moveTo(x * cellSize, 0);
                ctx.lineTo(x * cellSize, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= height; y++) {
                ctx.beginPath();
                ctx.moveTo(0, y * cellSize);
                ctx.lineTo(canvas.width, y * cellSize);
                ctx.stroke();
            }
        }
        
        function updatePreview() {
            previewCtx.fillStyle = '#000';
            previewCtx.fillRect(0, 0, width, height);
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    if (pixels[y][x]) {
                        previewCtx.fillStyle = pixels[y][x];
                        previewCtx.fillRect(x, y, 1, 1);
                    }
                }
            }
        }
        
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / cellSize);
            const y = Math.floor((e.clientY - rect.top) / cellSize);
            return { x, y };
        }
        
        function setPixel(x, y) {
            if (x >= 0 && x < width && y >= 0 && y < height) {
                if (currentTool === 'draw') {
                    pixels[y][x] = colorPicker.value;
                } else if (currentTool === 'erase') {
                    pixels[y][x] = null;
                } else if (currentTool === 'picker' && pixels[y][x]) {
                    colorPicker.value = pixels[y][x];
                } else if (currentTool === 'fill') {
                    floodFill(x, y, pixels[y][x], colorPicker.value);
                }
                drawGrid();
                updatePreview();
            }
        }
        
        function floodFill(x, y, targetColor, fillColor) {
            if (targetColor === fillColor) return;
            if (x < 0 || x >= width || y < 0 || y >= height) return;
            if (pixels[y][x] !== targetColor) return;
            
            pixels[y][x] = fillColor;
            floodFill(x + 1, y, targetColor, fillColor);
            floodFill(x - 1, y, targetColor, fillColor);
            floodFill(x, y + 1, targetColor, fillColor);
            floodFill(x, y - 1, targetColor, fillColor);
        }
        
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            const pos = getMousePos(e);
            setPixel(pos.x, pos.y);
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing && (currentTool === 'draw' || currentTool === 'erase')) {
                const pos = getMousePos(e);
                setPixel(pos.x, pos.y);
            }
        });
        
        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });
        
        canvas.addEventListener('mouseleave', () => {
            isDrawing = false;
        });
        
        function setColor(color) {
            colorPicker.value = color;
        }
        
        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-buttons button').forEach(btn => {
                btn.classList.remove('active-tool');
            });
            document.getElementById(tool + 'Btn').classList.add('active-tool');
        }
        
        function clearCanvas() {
            if (confirm('Clear the entire canvas?')) {
                pixels = Array(height).fill().map(() => Array(width).fill(null));
                drawGrid();
                updatePreview();
            }
        }
        
        function resizeCanvas() {
            const newWidth = parseInt(document.getElementById('width').value);
            const newHeight = parseInt(document.getElementById('height').value);
            
            const newPixels = Array(newHeight).fill().map(() => Array(newWidth).fill(null));
            
            // Copy existing pixels
            for (let y = 0; y < Math.min(height, newHeight); y++) {
                for (let x = 0; x < Math.min(width, newWidth); x++) {
                    newPixels[y][x] = pixels[y][x];
                }
            }
            
            pixels = newPixels;
            initCanvas();
        }
        
        function hexToRgb565(hex) {
            const r = parseInt(hex.substr(1, 2), 16);
            const g = parseInt(hex.substr(3, 2), 16);
            const b = parseInt(hex.substr(5, 2), 16);
            
            const r5 = (r >> 3) & 0x1F;
            const g6 = (g >> 2) & 0x3F;
            const b5 = (b >> 3) & 0x1F;
            
            return (r5 << 11) | (g6 << 5) | b5;
        }
        
        function generateCode() {
            const spriteName = document.getElementById('spriteName').value.toUpperCase();
            const transparentColor = document.getElementById('transparentColor').value;
            
            let code = `// Sprite: ${spriteName}\n`;
            code += `// Size: ${width}x${height} pixels\n`;
            code += `// Format: RGB565 (16-bit color)\n`;
            code += `#define ${spriteName}_WIDTH ${width}\n`;
            code += `#define ${spriteName}_HEIGHT ${height}\n`;
            code += `#define ${spriteName}_TRANSPARENT ${transparentColor}\n\n`;
            code += `const uint8_t ${spriteName}[] = {\n`;
            
            const bytes = [];
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const color = pixels[y][x];
                    const rgb565 = color ? hexToRgb565(color) : 0x0000;
                    const high = (rgb565 >> 8) & 0xFF;
                    const low = rgb565 & 0xFF;
                    bytes.push(`0x${high.toString(16).padStart(2, '0')}`);
                    bytes.push(`0x${low.toString(16).padStart(2, '0')}`);
                }
            }
            
            // Format in rows of 16 bytes
            for (let i = 0; i < bytes.length; i += 16) {
                const line = bytes.slice(i, i + 16).join(', ');
                code += `    ${line}${i + 16 < bytes.length ? ',' : ''}\n`;
            }
            
            code += `};\n\n`;
            code += `// Usage example:\n`;
            code += `// Sprite sprite(${spriteName}, ${spriteName}_WIDTH, ${spriteName}_HEIGHT, ${spriteName}_TRANSPARENT);\n`;
            
            document.getElementById('codeOutput').textContent = code;
        }
        
        function copyToClipboard() {
            const code = document.getElementById('codeOutput').textContent;
            if (code && code !== '// Click "Generate Code" to see output here') {
                navigator.clipboard.writeText(code).then(() => {
                    alert('Code copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    alert('Failed to copy to clipboard. Please select and copy manually.');
                });
            } else {
                alert('Generate code first!');
            }
        }
        
        // Initialize on load
        initCanvas();
    </script>
</body>
</html>
